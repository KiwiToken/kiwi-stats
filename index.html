<!--
Attributions:
  Milligram - https://github.com/milligram/milligram
  ionicons - http://ionicons.com/
  ethjs - https://github.com/ethjs/ethjs
  Google Material Design Color Palatte - https://htmlcolorcodes.com/color-chart/material-design-color-chart/
  Chart.js - http://www.chartjs.org/
-->

<html>
  <head>
    <meta charset='utf-8'>
    <!-- jquery is here because scripts need it early on. may want to move other js imports here. -->
    <script type="text/javascript" src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.min.js"></script>

    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/milligram/1.2.3/milligram.min.css">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=Roboto:300,300italic,700,700italic">
    <link rel="stylesheet" type="text/css" href="//cdn.rawgit.com/necolas/normalize.css/master/normalize.css">
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/themes/dark1.css">

    <!--<link rel="stylesheet" type="text/css" href="/css/dark_custom.css">-->
    <title>0xBitcoin Statistics</title>
    <meta name="descripton" content="Live statistics for 0xBitcoin - the mined bitcoin-like token for Ethereum.">
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-117165354-1"></script>
    <script type="text/javascript" src="js/gtag.js"></script>
  </head>
  <body>
    <script type="text/javascript">
      var el = function(id){ return document.querySelector(id); };

      var log = function(){
        // 1. Convert args to a normal array
        var args = Array.prototype.slice.call(arguments);
        // 2. Prepend log prefix log string
        args.unshift(((Date.now()-globalTimerStart)/1000).toFixed(2) + 's ');
        // 3. Pass along arguments to console.log
        console.log.apply(console, args);
      }
      var globalTimerStart = Date.now();

      let searchParams = new URLSearchParams(window.location.search)
      //if(searchParams.has('theme') && searchParams.get('theme') == 'dark1') {
        //$('head').append('<link rel="stylesheet" type="text/css" href="css/themes/dark1.css">');
      //}
    </script>
    <div class="container">
      <div class="row">
        <div class="column"><h1>0xBTC</h1></div>
        <div class="column"><h1>Token Statistics</h1></div>
      </div>
      <div class="row">
        <div class="column">
          <ul id="navigation" class="nav">
            <li class="nav"><a href="./?page=stats&#">stats</a></li>
            <li class="nav"><a href="./?page=stats&#miners">miners</a></li>
            <li class="nav"><a href="./?page=stats&#blocks">blocks</a></li>
            <li class="nav"><a href="./?page=stats&#miningcalculator">mining calculator</a></li>
            <li class="nav"><a href="./?page=graphs&#difficulty">difficulty / hashrate <span style="color:#FF1744;">(new)</span></a></li>
            <li class="nav"><a href="./?page=graphs&#reward-time">reward time / supply</a></li>
          </ul>
        </div>
      </div>
      <!--
      <div class="row">
        <div class="column"><button type="button" onClick="location.href='#miners'" class="nav-miners">MINERS</button></div>
        <div class="column"><button type="button" onClick="location.href='#blocks'" class="nav-blocks">BLOCKS</button></div>
        <div class="column"><button type="button" onClick="location.href='#blockrate'" class="nav-blockrate">INFLATION</button></div>
        <div class="column"><button type="button" onClick="location.href='#difficulty'" class="nav-difficulty">DIFFICULTY</button></div>
        <div class="column"><button type="button" onClick="location.href='#hashrate'" class="nav-hashrate">HASHRATE</button></div>
      </div>-->
      <div id="row-statistics">
        <div class="row">
          <div class="column"><h4 class="add-top-padding">Current Contract Status</h4></div>
        </div>
        <div class="row">
          <div class="column">
            <table>
              <!--<thead> <tr> <th> </th> <th> </th> </tr> </thead>-->
              <tbody id="statistics">
                <tr><td colspan="2">Loading info from the blockchain...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div id="row-miners">
        <div class="row">
          <div class="column"><h4 class="add-top-padding"><a name="miners"></a>Block distribution since last retarget</h4></div>
        </div>
        <div class="row">
          <div class="column column-25" style="max-width:30rem;">
            <div id="blockdistributionpiechart"></div>
          </div>
          <div class="column">
            <table>
              <!--<thead id="minerstats"> <tr> <th> </th> <th> </th> </tr> </thead>-->
              <tbody id="minerstats">
                <tr><td colspan="3">Loading info from the blockchain...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
      <div id="row-blocks">
        <div class="row">
          <div class="column"><h4 class="add-top-padding"><a name="blocks"></a>Blocks solved since last retarget</h4></div>
        </div>
        <div class="row">
          <div class="column">
            <table>
              <!--<thead id="minerstats"> <tr> <th> </th> <th> </th> </tr> </thead>-->
              <tbody id="blockstats">
                <tr><td colspan="3">Loading info from the blockchain...</td></tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    
      <div id="row-miningcalculator">
        <div class="row">
          <div class="column"><h4 class="add-top-padding"><a name="miningcalculator"></a>Mining calculator</h4></div>
        </div>
        <div class="row">
          <div class="column">
            <p>
              <em>Coming soon! For now, you can use this:</em>
            </p>
            <p>
              <em>tokens per day = 4,320,000  x  hashrate  /  (difficulty  x  2<sup>22</sup>)</em>
              <br>
              Note: this does <span style="font-weight:600;">not</span> factor pool fees. Subtract 15% from the final amount.
            </p>
            <p>
              Above is based on the hashrate equation:
              <br>
              time to solve a block in seconds = difficulty x 2<sup>22</sup> / hashrate
            </p>
          </div>
        </div>
      </div>


      <div id="row-difficulty">
        <div class="row">
          <div class="column"><h4 class="add-top-padding"><a name="difficulty"></a>Hashrate and Difficulty over the last 60 days</h4></div>
        </div>
        <!-- <div class="row">
          <div class="column">
            Note: Experimental. Timestamps are estimated (should be within 10%). 
            <br>
            <br>
          </div>
        </div> -->
        <div class="row">
          <div class="column">
            <div id='difficultystats'>
              Loading info from the blockchain...
            </div>
          </div>
        </div>
      </div>

      <div id="row-reward-time">
        <div class="row">
          <div class="column"><h4 class="add-top-padding"><a name="reward-time"></a>Average Reward Time and Supply over the last 60 days</h4></div>
        </div>
        <div class="row">
          <div class="column">
            <div id='blocktimestats'>
              Loading info from the blockchain...
            </div>
          </div>
        </div>
      </div>

<!--
      <div class="row">
        <div class="column"><h4 class="add-top-padding"><a name="blockrate"></a>Minutes per reward</h4></div>
      </div>
      <div class="row">
        <div class="column">
          <table>
            <tbody id="blockratestats">
              <tr><td colspan="3">Loading info from the blockchain...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
      
      <div class="row">
        <div class="column"><h4 class="add-top-padding"><a name="hashrate"></a>Network hashrate over time</h4></div>
      </div>
      <div class="row">
        <div class="column">
          <table>
            <tbody id="difficultystats">
              <tr><td colspan="3">Loading info from the blockchain...</td></tr>
            </tbody>
          </table>
        </div>
      </div>
-->

      <div id="row-footer">
        <div class="row add-top-padding">
          <div class="column">
            Data fetched at:
            <span id="LastUpdatedTime">00:00:00</span>
            <div style="font-size:0.875em;">
              0xBitcoin Stats
              <span id="footerversion">
                v0.0.0
              </span>
            </div>
          </div>
          <div class="column"><font color="#C0392B">‚ù§</font> <a href="https://etherscan.io/address/0x1d00FFffB205CC0C5a51E7c77a7668A8B90BBb90">0x1d00FFffB205CC0C5a51E7c77a7668A8B90BBb90</a></div>
        </div>
      </div>
    </div>

    <script type="text/javascript" src="js/ethereumjs-testrpc.js"></script>
    <script type="text/javascript" src="js/ethjs.js"></script>
    <script type="text/javascript" src="js/abi.js"></script>
    <script type="text/javascript" src="js/main.js"></script>
    <script type="text/javascript" src="js/graphs.js"></script>

    <script type="text/javascript">
      try {
        $(document).ready(function() {
           log("DOMready");
        });
      } catch (err) {
        log('failed to set DOMready fn. Jquery load error?');
        el('#statistics').innerHTML = "Sorry, failed to load jquery. Try again later.";
        fail;
      } finally {
        let searchParams = new URLSearchParams(window.location.search)

        if(searchParams.has('reload')) {
          var time = searchParams.get('reload');
          setTimeout(function(){
            location.reload()
          },time*60000)
        }

        if(!searchParams.has('page')
          || searchParams.get('page') == 'stats') {
          if(!searchParams.has('page')){
            addToURL('?page=stats&');
          }
          log('STATS selected');
          //$(document).attr("title", "0xBitcoin Statistics");
          updateAllStats();
        }else if(searchParams.get('page') == 'graphs') {
          log('GRAPHS selected');
          $(document).attr("title", "0xBitcoin Statistics - Graphs");
          updateGraphData();
        }
      }
    </script>
  </body>
</html>
